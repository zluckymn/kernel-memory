# Understanding the kernel  了解内核

- 04/16/2025




The kernel is the central component of Semantic Kernel. At its simplest, the kernel is a Dependency Injection container that manages all of the services and plugins necessary to run your AI application. If you provide all of your services and plugins to the kernel, they will then be seamlessly used by the AI as needed.
内核是Kernel的核心组件。简单来说，内核是一个依赖注入容器，用于管理运行 AI 应用程序所需的所有服务和插件。如果您将所有服务和插件提供给内核，那么 AI 将根据需要无缝使用它们。



## The kernel is at the center 内核在中心

Because the kernel has all of the services and plugins necessary to run both native code and AI services, it is used by nearly every component within the Semantic Kernel SDK to power your agents. This means that if you run any prompt or code in Semantic Kernel, the kernel will always be available to retrieve the necessary services and plugins.
由于内核具有运行本机代码和 AI 服务所需的所有服务和插件，因此Kernel SDK 中的几乎每个组件都使用它来为您的代理提供支持。这意味着，如果您在Kernel中运行任何提示或代码，内核将始终可用于检索必要的服务和插件。

![The kernel is at the center of everything in Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/media/the-kernel-is-at-the-center-of-everything.png)

This is extremely powerful, because it means you as a developer have a single place where you can configure, and most importantly monitor, your AI agents. Take for example, when you invoke a prompt from the kernel. When you do so, the kernel will...
这非常强大，因为这意味着作为开发人员，您有一个地方可以配置 AI 代理，最重要的是监控您的 AI 代理。例如，当您从内核调用提示时。当你这样做时，内核将...

1. Select the best AI service to run the prompt.
   选择最佳 AI 服务来运行提示。
2. Build the prompt using the provided prompt template.
   使用提供的提示模板生成提示。
3. Send the prompt to the AI service.
   将提示发送到 AI 服务。
4. Receive and parse the response.
   接收并解析响应。
5. And finally return the response from the LLM to your application.
   最后，将 LLM 的响应返回到您的应用程序。

Throughout this entire process, you can create events and middleware that are triggered at each of these steps. This means you can perform actions like logging, provide status updates to users, and most importantly responsible AI. All from a single place.
在整个过程中，您可以创建在每个步骤中触发的事件和中间件。这意味着您可以执行日志记录、向用户提供状态更新以及最重要的是负责任的 AI 等作。全部来自一个地方。



## Build a kernel with services and plugins 使用服务和插件构建内核

Before building a kernel, you should first understand the two types of components that exist:
在构建内核之前，您应该首先了解存在的两种类型的组件：

  展开表

| Component  元件      | Description  描述                                            |
| :------------------- | :----------------------------------------------------------- |
| **Services  服务业** | These consist of both AI services (e.g., chat completion) and other services (e.g., logging and HTTP clients) that are necessary to run your application. This was modelled after the Service Provider pattern in .NET so that we could support dependency injection across all languages. 这些服务包括运行应用程序所需的 AI 服务（例如聊天完成）和其他服务（例如日志记录和 HTTP 客户端）。这是根据 .NET 中的服务提供商模式建模的，因此我们可以支持跨所有语言的依赖项注入。 |
| **Plugins  插件**    | These are the components that are used by your AI services and prompt templates to perform work. AI services, for example, can use plugins to retrieve data from a database or call an external API to perform actions. 这些是 AI 服务和提示模板用于执行工作的组件。例如，人工智能服务可以使用插件从数据库中检索数据或调用外部 API 来执行作。 |

To start creating a kernel, import the necessary packages at the top of your file:
要开始创建内核，请在文件顶部导入必要的包：

C#Copy  复制

```csharp
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Microsoft.SemanticKernel;
using Microsoft.SemanticKernel.Plugins.Core;
```

Next, you can add services and plugins. Below is an example of how you can add an Azure OpenAI chat completion, a logger, and a time plugin.
接下来，您可以添加服务和插件。下面是如何添加 Azure OpenAI 聊天完成、记录器和时间插件的示例。

C#Copy  复制

```csharp
// Create a kernel with a logger and Azure OpenAI chat completion service
var builder = Kernel.CreateBuilder();
builder.AddAzureOpenAIChatCompletion(modelId, endpoint, apiKey);
builder.Services.AddLogging(c => c.AddDebug().SetMinimumLevel(LogLevel.Trace));
builder.Plugins.AddFromType<TimePlugin>();
Kernel kernel = builder.Build();
```



## Using Dependency Injection 使用依赖注入

In C#, you can use Dependency Injection to create a kernel. This is done by creating a `ServiceCollection` and adding services and plugins to it. Below is an example of how you can create a kernel using Dependency Injection.
在 C# 中，您可以使用依赖注入来创建内核。这是通过创建一个 `ServiceCollection` 并向其添加服务和插件来完成的。下面是如何使用依赖注入创建内核的示例。

 Tip  提示

We recommend that you create a kernel as a transient service so that it is disposed of after each use because the plugin collection is mutable. The kernel is extremely lightweight (since it's just a container for services and plugins), so creating a new kernel for each use is not a performance concern.
我们建议您将内核创建为临时服务，以便在每次使用后将其丢弃，因为插件集合是可变的。内核非常轻量级（因为它只是服务和插件的容器），因此为每次使用创建一个新内核不是性能问题。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel;

var builder = Host.CreateApplicationBuilder(args);

// Add the OpenAI chat completion service as a singleton
builder.Services.AddOpenAIChatCompletion(
    modelId: "gpt-4",
    apiKey: "YOUR_API_KEY",
    orgId: "YOUR_ORG_ID", // Optional; for OpenAI deployment
    serviceId: "YOUR_SERVICE_ID" // Optional; for targeting specific services within Semantic Kernel
);

// Create singletons of your plugins
builder.Services.AddSingleton(() => new LightsPlugin());
builder.Services.AddSingleton(() => new SpeakerPlugin());

// Create the plugin collection (using the KernelPluginFactory to create plugins from objects)
builder.Services.AddSingleton<KernelPluginCollection>((serviceProvider) => 
    [
        KernelPluginFactory.CreateFromObject(serviceProvider.GetRequiredService<LightsPlugin>()),
        KernelPluginFactory.CreateFromObject(serviceProvider.GetRequiredService<SpeakerPlugin>())
    ]
);

// Finally, create the Kernel service with the service provider and plugin collection
builder.Services.AddTransient((serviceProvider)=> {
    KernelPluginCollection pluginCollection = serviceProvider.GetRequiredService<KernelPluginCollection>();

    return new Kernel(serviceProvider, pluginCollection);
});
```

 Tip  提示

For more samples on how to use dependency injection in C#, refer to the [concept samples](https://learn.microsoft.com/en-us/semantic-kernel/get-started/detailed-samples).
有关如何在 C# 中使用依赖项注入的更多示例，请参阅[概念示例 ](https://learn.microsoft.com/en-us/semantic-kernel/get-started/detailed-samples)。



## Next steps  后续步骤

Now that you understand the kernel, you can learn about all the different AI services that you can add to it.
现在您已经了解了内核，您可以了解可以添加到内核的所有不同 AI 服务。Semantic Kernel Components Kernel组件