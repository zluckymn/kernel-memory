# What are Semantic Kernel Text Search plugins? 什么是Semantic Kernel文本搜索插件？

- 10/16/2024

Semantic Kernel uses [Plugins](https://learn.microsoft.com/en-us/semantic-kernel/concepts/plugins/) to connect existing APIs with AI. These Plugins have functions that can be used to add relevant data or examples to prompts, or to allow the AI to perform actions automatically.
Semantic Kernel使用[插件](https://learn.microsoft.com/en-us/semantic-kernel/concepts/plugins/)将现有 API 与 AI 连接起来。这些插件具有可用于向提示添加相关数据或示例的功能，或允许 AI 自动执行作。

To integrate Text Search with Semantic Kernel, we need to turn it into a Plugin. Once we have a Text Search plugin, we can use it to add relevant information to prompts or to retrieve information as needed. Creating a plugin from Text Search is a simple process, which we will explain below.
要将文本搜索与Semantic Kernel集成，我们需要将其转换为插件。一旦我们有了文本搜索插件，我们就可以使用它将相关信息添加到提示中或根据需要检索信息。从文本搜索创建插件是一个简单的过程，我们将在下面解释。

 Tip  提示

To run the samples shown on this page go to [GettingStartedWithTextSearch/Step2_Search_For_RAG.cs](https://github.com/microsoft/semantic-kernel/blob/main/dotnet/samples/GettingStartedWithTextSearch/Step2_Search_For_RAG.cs).
若要运行此页上显示的示例，请转到 [GettingStartedWithTextSearch/Step2_Search_For_RAG.cs](https://github.com/microsoft/semantic-kernel/blob/main/dotnet/samples/GettingStartedWithTextSearch/Step2_Search_For_RAG.cs)。



## Basic search plugin  基本搜索插件

Semantic Kernel provides a default template implementation that supports variable substitution and function calling. By including an expression such as `{{MyPlugin.Function $arg1}}` in a prompt template, the specified function i.e., `MyPlugin.Function` will be invoked with the provided argument `arg1` (which is resolved from `KernelArguments`). The return value from the function invocation is inserted into the prompt. This technique can be used to inject relevant information into a prompt.
Semantic Kernel提供了一个默认的模板实现，支持变量替换和函数调用。通过在提示模板中包含 `{{MyPlugin.Function $arg 1}}` 之类的表达式，指定的函数（` 即 MyPlugin.Function`）将使用提供的参数 `arg1`（从 `KernelArguments` 解析）调用。函数调用的返回值将插入到提示符中。此技术可用于将相关信息注入提示中。

The sample below shows how to create a plugin named `SearchPlugin` from an instance of `BingTextSearch`. Using `CreateWithSearch` creates a new plugin with a single `Search` function that calls the underlying text search implementation. The `SearchPlugin` is added to the `Kernel` which makes it available to be called during prompt rendering. The prompt template includes a call to `{{SearchPlugin.Search $query}}` which will invoke the `SearchPlugin` to retrieve results related to the current query. The results are then inserted into the rendered prompt before it is sent to the AI model.
下面的示例演示如何从 `BingTextSearch` 的实例创建名为 `SearchPlugin` 的插件。使用 `CreateWithSearch` 创建一个新插件，其中包含一个调用底层文本搜索实现的`单个搜索`函数。`SearchPlugin` 被添加到`内核`中，使其可以在提示渲染期间调用。提示模板包括一个调用， `{{SearchPlugin.Search $query}}` 该调用将调用 `SearchPlugin` 来检索与当前查询相关的结果。然后，结果入渲染的提示中，然后再发送到 AI 模型。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel.Data;
using Microsoft.SemanticKernel.Plugins.Web.Bing;

// Create a kernel with OpenAI chat completion
IKernelBuilder kernelBuilder = Kernel.CreateBuilder();
kernelBuilder.AddOpenAIChatCompletion(
        modelId: "gpt-4o",
        apiKey: "<Your OpenAI API Key>");
Kernel kernel = kernelBuilder.Build();

// Create a text search using Bing search
var textSearch = new BingTextSearch(apiKey: "<Your Bing API Key>");

// Build a text search plugin with Bing search and add to the kernel
var searchPlugin = textSearch.CreateWithSearch("SearchPlugin");
kernel.Plugins.Add(searchPlugin);

// Invoke prompt and use text search plugin to provide grounding information
var query = "What is the Semantic Kernel?";
var prompt = "{{SearchPlugin.Search $query}}. {{$query}}";
KernelArguments arguments = new() { { "query", query } };
Console.WriteLine(await kernel.InvokePromptAsync(prompt, arguments));
```



## Search plugin with citations 搜索带有引文的插件

The sample below repeats the pattern described in the previous section with a few notable changes:
下面的示例重复了上一节中描述的模式，但有一些显着的变化：

1. `CreateWithGetTextSearchResults` is used to create a `SearchPlugin` which calls the `GetTextSearchResults` method from the underlying text search implementation.
   `CreateWithGetTextSearchResults` 用于创建一个 `SearchPlugin`，该插件从基础文本搜索实现调用 `GetTextSearchResults` 方法。
2. The prompt template uses Handlebars syntax. This allows the template to iterate over the search results and render the name, value and link for each result.
   提示模板使用 Handlebars 语法。这允许模板迭代搜索结果并呈现每个结果的名称、值和链接。
3. The prompt includes an instruction to include citations, so the AI model will do the work of adding citations to the response.
   该提示包括包含引文的指令，因此 AI 模型将完成在响应中添加引文的工作。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel.Data;
using Microsoft.SemanticKernel.PromptTemplates.Handlebars;
using Microsoft.SemanticKernel.Plugins.Web.Bing;

// Create a kernel with OpenAI chat completion
IKernelBuilder kernelBuilder = Kernel.CreateBuilder();
kernelBuilder.AddOpenAIChatCompletion(
        modelId: "gpt-4o",
        apiKey: "<Your OpenAI API Key>");
Kernel kernel = kernelBuilder.Build();

// Create a text search using Bing search
var textSearch = new BingTextSearch(apiKey: "<Your Bing API Key>");

// Build a text search plugin with Bing search and add to the kernel
var searchPlugin = textSearch.CreateWithGetTextSearchResults("SearchPlugin");
kernel.Plugins.Add(searchPlugin);

// Invoke prompt and use text search plugin to provide grounding information
var query = "What is the Semantic Kernel?";
string promptTemplate = """
{{#with (SearchPlugin-GetTextSearchResults query)}}  
    {{#each this}}  
    Name: {{Name}}
    Value: {{Value}}
    Link: {{Link}}
    -----------------
    {{/each}}  
{{/with}}  

{{query}}

Include citations to the relevant information where it is referenced in the response.
""";
KernelArguments arguments = new() { { "query", query } };
HandlebarsPromptTemplateFactory promptTemplateFactory = new();
Console.WriteLine(await kernel.InvokePromptAsync(
    promptTemplate,
    arguments,
    templateFormat: HandlebarsPromptTemplateFactory.HandlebarsTemplateFormat,
    promptTemplateFactory: promptTemplateFactory
));
```



## Search plugin with a filter 带有过滤器的搜索插件

The samples shown so far will use the top ranked web search results to provide the grounding data. To provide more reliability in the data the web search can be restricted to only return results from a specified site.
到目前为止显示的示例将使用排名靠前的 Web 搜索结果来提供接地数据。为了提供更高的数据可靠性，可以将 Web 搜索限制为仅返回来自指定站点的结果。

The sample below builds on the previous one to add filtering of the search results. A `TextSearchFilter` with an equality clause is used to specify that only results from the Microsoft Developer Blogs site (`site == 'devblogs.microsoft.com'`) are to be included in the search results.
下面的示例基于前一个示例，以添加搜索结果的筛选。具有相等子句的 `TextSearchFilter` 用于指定搜索结果中仅包含来自 Microsoft 开发人员博客网站 （ `site == 'devblogs.microsoft.com'` ） 的结果。

The sample uses `KernelPluginFactory.CreateFromFunctions` to create the `SearchPlugin`. A custom description is provided for the plugin. The `ITextSearch.CreateGetTextSearchResults` extension method is used to create the `KernelFunction` which invokes the text search service.
该示例用于 `KernelPluginFactory.CreateFromFunctions` 创建 `SearchPlugin`。为插件提供了自定义描述。 `ITextSearch.CreateGetTextSearchResults` 扩展方法用于创建调用文本搜索服务的 `KernelFunction`。

 Tip  提示

The `site` filter is Bing specific. For Google web search use `siteSearch`.
`网站`筛选器特定于必应。对于 Google 网络搜索，请使用 `siteSearch`。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel.Data;
using Microsoft.SemanticKernel.Plugins.Web.Bing;

// Create a kernel with OpenAI chat completion
IKernelBuilder kernelBuilder = Kernel.CreateBuilder();
kernelBuilder.AddOpenAIChatCompletion(
        modelId: "gpt-4o",
        apiKey: "<Your OpenAI API Key>");
Kernel kernel = kernelBuilder.Build();

// Create a text search using Bing search
var textSearch = new BingTextSearch(apiKey: "<Your Bing API Key>");

// Create a filter to search only the Microsoft Developer Blogs site
var filter = new TextSearchFilter().Equality("site", "devblogs.microsoft.com");
var searchOptions = new TextSearchOptions() { Filter = filter };

// Build a text search plugin with Bing search and add to the kernel
var searchPlugin = KernelPluginFactory.CreateFromFunctions(
    "SearchPlugin", "Search Microsoft Developer Blogs site only",
    [textSearch.CreateGetTextSearchResults(searchOptions: searchOptions)]);
kernel.Plugins.Add(searchPlugin);

// Invoke prompt and use text search plugin to provide grounding information
var query = "What is the Semantic Kernel?";
string promptTemplate = """
{{#with (SearchPlugin-GetTextSearchResults query)}}  
    {{#each this}}  
    Name: {{Name}}
    Value: {{Value}}
    Link: {{Link}}
    -----------------
    {{/each}}  
{{/with}}  

{{query}}

Include citations to the relevant information where it is referenced in the response.
""";
KernelArguments arguments = new() { { "query", query } };
HandlebarsPromptTemplateFactory promptTemplateFactory = new();
Console.WriteLine(await kernel.InvokePromptAsync(
    promptTemplate,
    arguments,
    templateFormat: HandlebarsPromptTemplateFactory.HandlebarsTemplateFormat,
    promptTemplateFactory: promptTemplateFactory
));
```

 Tip  提示

Follow the link for more information on how to [filter the answers that Bing returns](https://learn.microsoft.com/en-us/bing/search-apis/bing-web-search/filter-answers#getting-results-from-a-specific-site).
点击链接，了解有关如何[筛选必应返回的答案](https://learn.microsoft.com/en-us/bing/search-apis/bing-web-search/filter-answers#getting-results-from-a-specific-site)的详细信息。



## Custom search plugin  自定义搜索插件

In the previous sample a static site filter was applied to the search operations. What if you need this filter to be dynamic?
在上一个示例中，静态站点筛选器已应用于搜索作。如果您需要此过滤器是动态的，该怎么办？

The next sample shows how you can perform more customization of the `SearchPlugin` so that the filter value can be dynamic. The sample uses `KernelFunctionFromMethodOptions` to specify the following for the `SearchPlugin`:
下一个示例演示如何对 `SearchPlugin` 执行更多自定义，以便筛选器值可以是动态的。该示例用于 `KernelFunctionFromMethodOptions` 为 `SearchPlugin` 指定以下内容：

- `FunctionName`: The search function is named `GetSiteResults` because it will apply a site filter if the query includes a domain.
  `FunctionName`：搜索函数名为 `GetSiteResults`，因为如果查询包含域，它将应用网站筛选器。
- `Description`: The description describes how this specialized search function works.
  `说明 `：说明描述了此专用搜索功能的工作原理。
- `Parameters`: The parameters include an additional optional parameter for the `site` so the domain can be specified.
  `参数 `：参数包括`站点`的附加可选参数，以便可以指定域。

Customizing the search function is required if you want to provide multiple specialized search functions. In prompts you can use the function names to make the template more readable. If you use function calling then the model will use the function name and description to select the best search function to invoke.
如果要提供多个专用搜索功能，则需要自定义搜索功能。在提示中，您可以使用函数名称使模板更具可读性。如果使用函数调用，则模型将使用函数名称和描述来选择要调用的最佳搜索函数。

When this sample is executed, the response will use [techcommunity.microsoft.com](https://techcommunity.microsoft.com/) as the source for relevant data.
执行此示例时，响应将使用 [techcommunity.microsoft.com](https://techcommunity.microsoft.com/) 作为相关数据的源。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel.Data;
using Microsoft.SemanticKernel.PromptTemplates.Handlebars;
using Microsoft.SemanticKernel.Plugins.Web.Bing;

// Create a kernel with OpenAI chat completion
IKernelBuilder kernelBuilder = Kernel.CreateBuilder();
kernelBuilder.AddOpenAIChatCompletion(
        modelId: "gpt-4o",
        apiKey: "<Your OpenAI API Key>");
Kernel kernel = kernelBuilder.Build();

// Create a text search using Bing search
var textSearch = new BingTextSearch(apiKey: "<Your Bing API Key>");

// Build a text search plugin with Bing search and add to the kernel
var options = new KernelFunctionFromMethodOptions()
{
    FunctionName = "GetSiteResults",
    Description = "Perform a search for content related to the specified query and optionally from the specified domain.",
    Parameters =
    [
        new KernelParameterMetadata("query") { Description = "What to search for", IsRequired = true },
        new KernelParameterMetadata("top") { Description = "Number of results", IsRequired = false, DefaultValue = 5 },
        new KernelParameterMetadata("skip") { Description = "Number of results to skip", IsRequired = false, DefaultValue = 0 },
        new KernelParameterMetadata("site") { Description = "Only return results from this domain", IsRequired = false },
    ],
    ReturnParameter = new() { ParameterType = typeof(KernelSearchResults<string>) },
};
var searchPlugin = KernelPluginFactory.CreateFromFunctions("SearchPlugin", "Search specified site", [textSearch.CreateGetTextSearchResults(options)]);
kernel.Plugins.Add(searchPlugin);

// Invoke prompt and use text search plugin to provide grounding information
var query = "What is the Semantic Kernel?";
string promptTemplate = """
    {{#with (SearchPlugin-GetSiteResults query)}}  
        {{#each this}}  
        Name: {{Name}}
        Value: {{Value}}
        Link: {{Link}}
        -----------------
        {{/each}}  
    {{/with}}  

    {{query}}

    Only include results from techcommunity.microsoft.com. 
    Include citations to the relevant information where it is referenced in the response.
    """;
KernelArguments arguments = new() { { "query", query } };
HandlebarsPromptTemplateFactory promptTemplateFactory = new();
Console.WriteLine(await kernel.InvokePromptAsync(
    promptTemplate,
    arguments,
    templateFormat: HandlebarsPromptTemplateFactory.HandlebarsTemplateFormat,
    promptTemplateFactory: promptTemplateFactory
));
```



## Next steps  后续步骤

 