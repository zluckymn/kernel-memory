# Task automation with agents 使用代理实现任务自动化

- 09/10/2024

Most AI agents today simply retrieve data and respond to user queries. AI agents, however, can achieve much more by using plugins to automate tasks on behalf of users. This allows users to delegate tasks to AI agents, freeing up time for more important work.
如今，大多数人工智能代理只是检索数据并响应用户查询。然而，人工智能代理可以通过使用插件代表用户自动执行任务来实现更多目标。这允许用户将任务委派给人工智能代理，从而腾出时间进行更重要的工作。

Once AI Agents start performing actions, however, it's important to ensure that they are acting in the best interest of the user. This is why we provide hooks / filters to allow you to control what actions the AI agent can take.
然而，一旦 AI 代理开始执行作，重要的是要确保它们的行为符合用户的最佳利益。这就是为什么我们提供钩子/过滤器来允许您控制 AI 代理可以采取的作。



## Requiring user consent  要求用户同意

When an AI agent is about to perform an action on behalf of a user, it should first ask for the user's consent. This is especially important when the action involves sensitive data or financial transactions.
当 AI 代理要代表用户执行作时，应首先征求用户的同意。当作涉及敏感数据或金融交易时，这一点尤其重要。

In Semantic Kernel, you can use the function invocation filter. This filter is always called whenever a function is invoked from an AI agent. To create a filter, you need to implement the `IFunctionInvocationFilter` interface and then add it as a service to the kernel.
在Semantic Kernel中，可以使用函数调用筛选器。每当从 AI 代理调用函数时，始终会调用此过滤器。若要创建筛选器，需要实现 `IFunctionInvocationFilter` 接口，然后将其作为服务添加到内核。

Here's an example of a function invocation filter that requires user consent:
下面是需要用户同意的函数调用筛选器的示例：

C#Copy  复制

```csharp
public class ApprovalFilterExample() : IFunctionInvocationFilter
{
    public async Task OnFunctionInvocationAsync(FunctionInvocationContext context, Func<FunctionInvocationContext, Task> next)
    {
        if (context.Function.PluginName == "DynamicsPlugin" && context.Function.Name == "create_order")
        {
            Console.WriteLine("System > The agent wants to create an approval, do you want to proceed? (Y/N)");
            string shouldProceed = Console.ReadLine()!;

            if (shouldProceed != "Y")
            {
                context.Result = new FunctionResult(context.Result, "The order creation was not approved by the user");
                return;
            }
        }

        await next(context);
    }
}
```

You can then add the filter as a service to the kernel:
然后，您可以将过滤器作为服务添加到内核：

C#Copy  复制

```csharp
IKernelBuilder builder = Kernel.CreateBuilder();
builder.Services.AddSingleton<IFunctionInvocationFilter, ApprovalFilterExample>();
Kernel kernel = builder.Build();
```

Now, whenever the AI agent tries to create an order using the `DynamicsPlugin`, the user will be prompted to approve the action.
现在，每当 AI 代理尝试使用 `DynamicsPlugin` 创建订单时，系统都会提示用户批准该作。

 Tip  提示

Whenever a function is cancelled or fails, you should provide the AI agent with a meaningful error message so it can respond appropriately. For example, if we didn't let the AI agent know that the order creation was not approved, it would assume that the order failed due to a technical issue and would try to create the order again.
每当函数被取消或失败时，您都应向 AI 代理提供有意义的错误消息，以便它能够做出适当的响应。例如，如果我们没有让 AI 代理知道订单创建未获批准，它会假设订单由于技术问题而失败，并尝试再次创建订单。



## Next steps  后续步骤

Now that you've learned how to allow agents to automate tasks, you can learn how to allow agents to automatically create plans to address user needs.
现在您已经了解了如何允许代理自动执行任务，您可以了解如何允许代理自动创建计划来满足用户需求。

[  使用代理自动规划](https://learn.microsoft.com/en-us/semantic-kernel/concepts/planning)