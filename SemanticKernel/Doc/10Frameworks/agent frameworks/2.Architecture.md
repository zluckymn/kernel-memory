# An Overview of the Agent Architecture 代理体系结构概述

- 05/29/2025

This article covers key concepts in the architecture of the Agent Framework, including foundational principles, design objectives, and strategic goals.
本文介绍了代理框架架构中的关键概念，包括基本原则、设计目标和战略目标。



## Goals  目标

The `Agent Framework` was developed with the following key priorities in mind:
`代理框架`在开发时考虑了以下关键优先事项：

- The Semantic Kernel agent framework serves as the core foundation for implementing agent functionalities.
  Semantic Kernel代理框架是实现代理功能的核心基础。
- Multiple agents of different types can collaborate within a single conversation, each contributing their unique capabilities, while integrating human input.
  不同类型的多个代理可以在单个对话中进行协作，每个代理都贡献其独特的功能，同时集成人工输入。
- An agent can engage in and manage multiple concurrent conversations simultaneously.
  代理可以同时参与和管理多个并发对话。



## Agent  代理

The abstract `Agent` class serves as the core abstraction for all types of agents, providing a foundational structure that can be extended to create more specialized agents. This base class forms the basis for more specific agent implementations, all of which leverage the Kernel's capabilities to execute their respective functions. See all the available agent types in the [Agent Types](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-architecture?pivots=programming-language-csharp#agent-types-in-semantic-kernel) section.
抽象 `Agent` 类充当所有类型代理的核心抽象，提供了一个可以扩展以创建更专业的代理的基础结构。该基类构成了更具体的代理实现的基础，所有这些都利用内核的功能来执行各自的功能。在[代理类型](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-architecture?pivots=programming-language-csharp#agent-types-in-semantic-kernel)部分查看所有可用的代理类型。

The underlying Semantic Kernel `Agent` abstraction can be found [here](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.agents.agent).
底层的Semantic Kernel`代理`抽象可以在[此处](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.agents.agent)找到。

Agents can either be invoked directly to perform tasks or be orchestrated by different patterns. This flexible structure allows agents to adapt to various conversational or task-driven scenarios, providing developers with robust tools for building intelligent, multi-agent systems.
代理可以直接调用来执行任务，也可以由不同的模式进行编排。这种灵活的结构使代理能够适应各种对话或任务驱动的场景，为开发人员提供构建智能多代理系统的强大工具。



### Agent Types in Semantic Kernel Semantic Kernel中的代理类型

- [`ChatCompletionAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/chat-completion-agent)
- [`OpenAIAssistantAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/assistant-agent)
- [`AzureAIAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/azure-ai-agent)
- [`OpenAIResponsesAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/responses-agent)
- [`CopilotStudioAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/copilot-studio-agent)



## Agent Thread  代理线程

The abstract `AgentThread` class serves as the core abstraction for threads or conversation state. It abstracts away the different ways in which conversation state may be managed for different agents.
抽象 `AgentThread` 类充当线程或对话状态的核心抽象。它抽象化了为不同代理管理对话状态的不同方式。

Stateful agent services often store conversation state in the service, and you can interact with it via an id. Other agents may require the entire chat history to be passed to the agent on each invocation, in which case the conversation state is managed locally in the application.
有状态代理服务通常将对话状态存储在服务中，您可以通过 ID 与其交互。其他代理可能需要在每次调用时将整个聊天历史记录传递给代理，在这种情况下，对话状态在应用程序中本地进行管理。

Stateful agents typically only work with a matching `AgentThread` implementation, while other types of agents could work with more than one `AgentThread` type. For example, `AzureAIAgent` requires a matching `AzureAIAgentThread`. This is because the Azure AI Agent service stores conversations in the service, and requires specific service calls to create a thread and update it. If a different agent thread type is used with the `AzureAIAgent`, we fail fast due to an unexpected thread type and raise an exception to alert the caller.
有状态代理通常仅适用于匹配的 `AgentThread` 实现，而其他类型的代理可以使用多个 `AgentThread` 类型。例如，`AzureAIAgent` 需要匹配的 `AzureAIAgentThread`。这是因为 Azure AI 代理服务将对话存储在服务中，并且需要特定的服务调用来创建线程并更新它。如果将不同的代理线程类型与 `AzureAIAgent` 一起使用，则由于意外的线程类型，我们会快速失败，并引发异常以提醒调用方。



## Agent Orchestration  代理编排

 Important  重要

Agent Orchestration features in the Agent Framework are in the experimental stage. They are under active development and may change significantly before advancing to the preview or release candidate stage.
代理框架中的代理业务流程功能处于实验阶段。它们正在积极开发中，在进入预览版或候选版本阶段之前可能会发生重大变化。

 Note  注意

If you have been using the [`AgentGroupChat`](https://learn.microsoft.com/en-us/semantic-kernel/support/archive/agent-chat) orchestration pattern, please note that it is no longer maintained. We recommend developers to use the new [`GroupChatOrchestration`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/group-chat) pattern. A migration guide is provided [here](https://learn.microsoft.com/en-us/semantic-kernel/support/migration/group-chat-orchestration-migration-guide).
如果您一直在使用 [`AgentGroupChat`](https://learn.microsoft.com/en-us/semantic-kernel/support/archive/agent-chat) 业务流程模式，请注意，它不再维护。建议开发人员使用新的 [`GroupChatOrchestration`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/group-chat) 模式。[ 此处](https://learn.microsoft.com/en-us/semantic-kernel/support/migration/group-chat-orchestration-migration-guide)提供了迁移指南。

The [Agent Orchestration](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/) framework in Semantic Kernel enables the coordination of multiple agents to solve complex tasks collaboratively. It provides a flexible structure for defining how agents interact, share information, and delegate responsibilities. The core components and concepts include:
Semantic Kernel中的[代理编排](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/)框架支持协调多个代理以协作解决复杂的任务。它提供了一个灵活的结构，用于定义代理如何交互、共享信息和委派职责。核心组件和概念包括：

- **Orchestration Patterns:** Pre-built patterns such as Concurrent, Sequential, Handoff, Group Chat, and Magentic allow developers to choose the most suitable collaboration model for their scenario. Each pattern defines a different way for agents to communicate and process tasks (see the [Orchestration patterns](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/#supported-orchestration-patterns) table for details).
  **编排模式：** 并发、顺序、切换、群聊和 Magentic 等预构建模式允许开发人员为其场景选择最合适的协作模型。每种模式都为代理定义了通信和处理任务的不同方式（有关详细信息，请参阅[业务流程模式](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/#supported-orchestration-patterns)表）。
- **Data Transform Logic:** Input and output transforms allow orchestration flows to adapt data between agents and external systems, supporting both simple and complex data types.
  **数据转换逻辑：** 输入和输出转换允许编排流在代理和外部系统之间调整数据，支持简单和复杂的数据类型。
- **Human-in-the-loop:** Some patterns support human-in-the-loop, enabling human agents to participate in the orchestration process. This is particularly useful for scenarios where human judgment or expertise is required.
  **人机交互：** 某些模式支持人机交互，使人类代理能够参与编排过程。这对于需要人类判断或专业知识的场景特别有用。

This architecture empowers developers to build intelligent, multi-agent systems that can tackle real-world problems through collaboration, specialization, and dynamic coordination.
该架构使开发人员能够构建智能的多代理系统，这些系统可以通过协作、专业化和动态协调来解决现实世界的问题。



## Agent Alignment with Semantic Kernel Features 代理与Semantic Kernel特征的对齐

The `Agent Framework` is built on the foundational concepts and features that many developers have come to know within the Semantic Kernel ecosystem. These core principles serve as the building blocks for the Agent Framework’s design. By leveraging the familiar structure and capabilities of the Semantic Kernel, the Agent Framework extends its functionality to enable more advanced, autonomous agent behaviors, while maintaining consistency with the broader Semantic Kernel architecture. This ensures a smooth transition for developers, allowing them to apply their existing knowledge to create intelligent, adaptable agents within the framework.
`代理框架`建立在许多开发人员在Semantic Kernel生态系统中了解的基本概念和功能之上。这些核心原则是代理框架设计的构建块。通过利用Semantic Kernel熟悉的结构和功能，代理框架扩展了其功能，以实现更高级、自主的代理行为，同时保持与更广泛的Semantic Kernel架构的一致性。这确保了开发人员的平稳过渡，使他们能够应用现有知识在框架内创建智能、适应性强的代理。



### Plugins and Function Calling 插件和函数调用

[Plugins](https://learn.microsoft.com/en-us/semantic-kernel/concepts/plugins/) are a fundamental aspect of the Semantic Kernel, enabling developers to integrate custom functionalities and extend the capabilities of an AI application. These plugins offer a flexible way to incorporate specialized features or business-specific logic into the core AI workflows. Additionally, agent capabilities within the framework can be significantly enhanced by utilizing [Plugins](https://learn.microsoft.com/en-us/semantic-kernel/concepts/plugins/) and leveraging [Function Calling](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/chat-completion/function-calling/). This allows agents to dynamically interact with external services or execute complex tasks, further expanding the scope and versatility of the AI system within diverse applications.
[插件](https://learn.microsoft.com/en-us/semantic-kernel/concepts/plugins/)是Semantic Kernel的一个基本方面，使开发人员能够集成自定义功能并扩展 AI 应用程序的功能。这些插件提供了一种灵活的方式，可以将专业功能或特定于业务的逻辑整合到核心 AI 工作流程中。此外，通过利用[插件](https://learn.microsoft.com/en-us/semantic-kernel/concepts/plugins/)和[函数调用 ](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/chat-completion/function-calling/)，可以显着增强框架内的代理功能。这使得代理能够与外部服务动态交互或执行复杂的任务，进一步扩展了人工智能系统在不同应用程序中的范围和多功能性。

Learn how to configure agents to use plugins [here](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-functions).
在[此处](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-functions)了解如何配置代理以使用插件。



### Agent Messages  代理消息

Agent messaging, including both input and response, is built upon the core content types of the Semantic Kernel, providing a unified structure for communication. This design choice simplifies the process of transitioning from traditional chat-completion patterns to more advanced agent-driven patterns in your application development. By leveraging familiar Semantic Kernel content types, developers can seamlessly integrate agent capabilities into their applications without needing to overhaul existing systems. This streamlining ensures that as you evolve from basic conversational AI to more autonomous, task-oriented agents, the underlying framework remains consistent, making development faster and more efficient.
代理消息传递（包括输入和响应）建立在Semantic Kernel的核心内容类型之上，为通信提供了统一的结构。此设计选择简化了应用程序开发中从传统聊天完成模式过渡到更高级代理驱动模式的过程。通过利用熟悉的Semantic Kernel内容类型，开发人员可以将代理功能无缝集成到他们的应用程序中，而无需彻底修改现有系统。这种简化可确保当您从基本的对话式 AI 发展到更加自主、面向任务的代理时，底层框架保持一致，从而使开发更快、更高效。

 Tip  提示

API reference:  API 参考：

- [`ChatHistory`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.chatcompletion.chathistory)
- [`ChatMessageContent`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.chatmessagecontent)
- [`KernelContent`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.kernelcontent)
- [`StreamingKernelContent`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.streamingkernelcontent)
- [`FileReferenceContent`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.filereferencecontent)
- [`AnnotationContent`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.agents.openai.annotationcontent)



### Templating  模板

An agent's role is primarily shaped by the instructions it receives, which dictate its behavior and actions. Similar to invoking a `Kernel` [prompt](https://learn.microsoft.com/en-us/semantic-kernel/concepts/prompts/), an agent's instructions can include templated parameters—both values and functions—that are dynamically substituted during execution. This enables flexible, context-aware responses, allowing the agent to adjust its output based on real-time input.
代理的角色主要取决于它收到的指令，这些指令决定了它的行为和行动。与调用`内核`[提示](https://learn.microsoft.com/en-us/semantic-kernel/concepts/prompts/)类似，代理的指令可以包含模板化参数（包括值和函数），这些参数在执行过程中被动态替换。这可以实现灵活的、上下文感知的响应，允许代理根据实时输入调整其输出。

Additionally, an agent can be configured directly using a Prompt Template Configuration, providing developers with a structured and reusable way to define its behavior. This approach offers a powerful tool for standardizing and customizing agent instructions, ensuring consistency across various use cases while still maintaining dynamic adaptability.
此外，可以使用提示模板配置直接配置代理，为开发人员提供一种结构化且可重用的方式来定义其行为。这种方法为标准化和自定义代理指令提供了强大的工具，确保各种用例的一致性，同时仍保持动态适应性。

Learn more about how to create an agent with Semantic Kernel template [here](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-templates).
在[此处](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-templates)了解有关如何使用Semantic Kernel模板创建代理的更多信息。



## Declarative Spec  声明式规范

> The documentation on using declarative specs is coming soon.
> 有关使用声明式规范的文档即将推出。



## Next steps  后续步骤

[  探索通用代理调用 API](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-api)