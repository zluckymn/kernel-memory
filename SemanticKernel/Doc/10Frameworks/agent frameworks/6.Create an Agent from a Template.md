# Create an Agent from a Semantic Kernel Template 从Semantic Kernel模板创建代理

- 05/23/2025



## Prompt Templates in Semantic Kernel Semantic Kernel中的提示模板

An agent's role is primarily shaped by the instructions it receives, which dictate its behavior and actions. Similar to invoking a `Kernel` [prompt](https://learn.microsoft.com/en-us/semantic-kernel/concepts/prompts/), an agent's instructions can include templated parameters—both values and functions—that are dynamically substituted during execution. This enables flexible, context-aware responses, allowing the agent to adjust its output based on real-time input.
代理的角色主要取决于它收到的指令，这些指令决定了它的行为和行动。与调用`内核`[提示](https://learn.microsoft.com/en-us/semantic-kernel/concepts/prompts/)类似，代理的指令可以包含模板化参数（包括值和函数），这些参数在执行过程中被动态替换。这可以实现灵活的、上下文感知的响应，允许代理根据实时输入调整其输出。

Additionally, an agent can be configured directly using a Prompt Template Configuration, providing developers with a structured and reusable way to define its behavior. This approach offers a powerful tool for standardizing and customizing agent instructions, ensuring consistency across various use cases while still maintaining dynamic adaptability.
此外，可以使用提示模板配置直接配置代理，为开发人员提供一种结构化且可重用的方式来定义其行为。这种方法为标准化和自定义代理指令提供了强大的工具，确保各种用例的一致性，同时仍保持动态适应性。

 Tip  提示

API reference:  API 参考：

- [`PromptTemplateConfig`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.prompttemplateconfig)
- [`KernelFunctionYaml.FromPromptYaml`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.kernelfunctionyaml.frompromptyaml#microsoft-semantickernel-kernelfunctionyaml-frompromptyaml(system-string-microsoft-semantickernel-iprompttemplatefactory-microsoft-extensions-logging-iloggerfactory))
- [`IPromptTemplateFactory`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.iprompttemplatefactory)
- [`KernelPromptTemplateFactory`](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.kernelprompttemplatefactory)
- [*Handlebars  车把*](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.prompttemplates.handlebars)
- [*Prompty  及时*](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.prompty)
- [*Liquid  液*](https://learn.microsoft.com/en-us/dotnet/api/microsoft.semantickernel.prompttemplates.liquid)



## Agent Instructions as a Template 代理指令作为模板

Creating an agent with template parameters provides greater flexibility by allowing its instructions to be easily customized based on different scenarios or requirements. This approach enables the agent's behavior to be tailored by substituting specific values or functions into the template, making it adaptable to a variety of tasks or contexts. By leveraging template parameters, developers can design more versatile agents that can be configured to meet diverse use cases without needing to modify the core logic.
使用模板参数创建代理允许根据不同的场景或要求轻松自定义其指令，从而提供了更大的灵活性。这种方法可以通过将特定值或函数替换到模板中来定制代理的行为，使其能够适应各种任务或上下文。通过利用模板参数，开发人员可以设计更通用的代理，这些代理可以配置为满足不同的用例，而无需修改核心逻辑。



### Chat Completion Agent  聊天完成代理

C#Copy  复制

```csharp
// Initialize a Kernel with a chat-completion service
Kernel kernel = ...;

ChatCompletionAgent agent =
    new()
    {
        Kernel = kernel,
        Name = "StoryTeller",
        Instructions = "Tell a story about {{$topic}} that is {{$length}} sentences long.",
        Arguments = new KernelArguments()
        {
            { "topic", "Dog" },
            { "length", "3" },
        }
    };
```



### OpenAI Assistant Agent  OpenAI 助手代理

Templated instructions are especially powerful when working with an [`OpenAIAssistantAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/assistant-agent). With this approach, a single assistant definition can be created and reused multiple times, each time with different parameter values tailored to specific tasks or contexts. This enables a more efficient setup, allowing the same assistant framework to handle a wide range of scenarios while maintaining consistency in its core behavior.
在使用 [`OpenAIAssistantAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/assistant-agent) 时，模板化指令特别强大。通过这种方法，可以多次创建和重用单个助手定义，每次都针对特定任务或上下文定制不同的参数值。这可以实现更高效的设置，允许同一个助手框架处理各种场景，同时保持其核心行为的一致性。

C#Copy  复制

```csharp
// Retrieve an existing assistant definition by identifier
AzureOpenAIClient client = OpenAIAssistantAgent.CreateAzureOpenAIClient(new AzureCliCredential(), new Uri("<your endpoint>"));
AssistantClient assistantClient = client.GetAssistantClient();
Assistant assistant = await client.GetAssistantAsync();
OpenAIAssistantAgent agent = new(assistant, assistantClient, new KernelPromptTemplateFactory(), PromptTemplateConfig.SemanticKernelTemplateFormat)
{
    Arguments = new KernelArguments()
    {
        { "topic", "Dog" },
        { "length", "3" },
    }
}
```



## Agent Definition from a Prompt Template 提示模板中的代理定义

The same Prompt Template Config used to create a Kernel Prompt Function can also be leveraged to define an agent. This allows for a unified approach in managing both prompts and agents, promoting consistency and reuse across different components. By externalizing agent definitions from the codebase, this method simplifies the management of multiple agents, making them easier to update and maintain without requiring changes to the underlying logic. This separation also enhances flexibility, enabling developers to modify agent behavior or introduce new agents by simply updating the configuration, rather than adjusting the code itself.
用于创建内核提示函数的相同提示模板配置也可用于定义代理。这允许采用统一的方法来管理提示和代理，从而促进不同组件之间的一致性和重用。通过从代码库外部化代理定义，此方法简化了多个代理的管理，使它们更易于更新和维护，而无需更改底层逻辑。这种分离还增强了灵活性，使开发人员能够通过简单地更新配置来修改代理行为或引入新代理，而不是调整代码本身。



### YAML Template  YAML 模板

YAMLCopy  复制

```yaml
name: GenerateStory
template: |
  Tell a story about {{$topic}} that is {{$length}} sentences long.
template_format: semantic-kernel
description: A function that generates a story about a topic.
input_variables:
  - name: topic
    description: The topic of the story.
    is_required: true
  - name: length
    description: The number of sentences in the story.
    is_required: true
```



### Agent Initialization  代理初始化

C#Copy  复制

```csharp
// Read YAML resource
string generateStoryYaml = File.ReadAllText("./GenerateStory.yaml");
// Convert to a prompt template config
PromptTemplateConfig templateConfig = KernelFunctionYaml.ToPromptTemplateConfig(generateStoryYaml);

// Create agent with Instructions, Name and Description
// provided by the template config.
ChatCompletionAgent agent =
    new(templateConfig)
    {
        Kernel = this.CreateKernelWithChatCompletion(),
        // Provide default values for template parameters
        Arguments = new KernelArguments()
        {
            { "topic", "Dog" },
            { "length", "3" },
        }
    };
```



## Overriding Template Values for Direct Invocation 覆盖直接调用的模板值

When invoking an agent directly, the agent's parameters can be overridden as needed. This allows for greater control and customization of the agent's behavior during specific tasks, enabling you to modify its instructions or settings on the fly to suit particular requirements.
直接调用代理时，可以根据需要覆盖代理的参数。这允许在特定任务期间更好地控制和自定义代理的行为，使您能够即时修改其指令或设置以满足特定要求。

C#Copy  复制

```csharp
// Initialize a Kernel with a chat-completion service
Kernel kernel = ...;

ChatCompletionAgent agent =
    new()
    {
        Kernel = kernel,
        Name = "StoryTeller",
        Instructions = "Tell a story about {{$topic}} that is {{$length}} sentences long.",
        Arguments = new KernelArguments()
        {
            { "topic", "Dog" },
            { "length", "3" },
        }
    };

KernelArguments overrideArguments =
    new()
    {
        { "topic", "Cat" },
        { "length", "3" },
    });

// Generate the agent response(s)
await foreach (ChatMessageContent response in agent.InvokeAsync([], options: new() { KernelArguments = overrideArguments }))
{
  // Process agent response(s)...
}
```



## How-To  作方法

For an end-to-end example for creating an agent from a *prompt-template*, see:
有关从*提示模板*创建代理的端到端示例，请参阅：

- [How-To: `ChatCompletionAgent`
  作方法：`ChatCompletionAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/examples/example-chat-agent)



## Next steps  后续步骤