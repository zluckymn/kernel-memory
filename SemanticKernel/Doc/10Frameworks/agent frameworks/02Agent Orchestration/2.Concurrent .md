# Concurrent Orchestration  并发编排

- 07/22/2025

Agent Orchestration features in the Agent Framework are in the experimental stage. They are under active development and may change significantly before advancing to the preview or release candidate stage.
代理框架中的代理业务流程功能处于实验阶段。它们正在积极开发中，在进入预览版或候选版本阶段之前可能会发生重大变化。

Concurrent orchestration enables multiple agents to work on the same task in parallel. Each agent processes the input independently, and their results are collected and aggregated. This approach is well-suited for scenarios where diverse perspectives or solutions are valuable, such as brainstorming, ensemble reasoning, or voting systems.
并发编排使多个代理能够并行处理同一任务。每个代理独立处理输入，并收集和聚合其结果。这种方法非常适合不同观点或解决方案有价值的场景，例如头脑风暴、集成推理或投票系统。

To learn more about the pattern, such as when to use the pattern or when to avoid the pattern, see [Concurrent orchestration](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/ai-agent-design-patterns#concurrent-orchestration).
若要了解有关该模式的详细信息，例如何时使用该模式或何时避免该模式，请参阅并[发业务流程 ](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/ai-agent-design-patterns#concurrent-orchestration)。



## Common Use Cases  常见用例

Multiple agents generate different solutions to a problem, and their responses are collected for further analysis or selection:
多个代理为一个问题生成不同的解决方案，并收集它们的响应以供进一步分析或选择：

![diagram](https://learn.microsoft.com/en-us/semantic-kernel/media/multi-agent-concurrent.png)



## What You'll Learn  您将学到什么

- How to define multiple agents with different expertise
  如何定义具有不同专业知识的多个代理
- How to orchestrate these agents to work concurrently on a single task
  如何编排这些代理程序以同时处理单个任务
- How to collect and process the results
  如何收集和处理结果



### Define Your Agents  定义您的代理

Agents are specialized entities that can process tasks. Here, we define two agents: a physics expert and a chemistry expert.
代理是可以处理任务的专用实体。在这里，我们定义了两个智能体：物理专家和化学专家。

 Tip  提示

The [`ChatCompletionAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/chat-completion-agent) is used here, but you can use any [agent type](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-architecture#agent-types-in-semantic-kernel).
此处使用 [`ChatCompletionAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/chat-completion-agent)，但您可以使用任何[代理类型 ](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-architecture#agent-types-in-semantic-kernel)。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel;
using Microsoft.SemanticKernel.Agents;
using Microsoft.SemanticKernel.Agents.Orchestration;
using Microsoft.SemanticKernel.Agents.Orchestration.Concurrent;
using Microsoft.SemanticKernel.Agents.Runtime.InProcess;

// Create a kernel with an AI service
Kernel kernel = ...;

ChatCompletionAgent physicist = new ChatCompletionAgent{
    Name = "PhysicsExpert",
    Instructions = "You are an expert in physics. You answer questions from a physics perspective."
    Kernel = kernel,
};

ChatCompletionAgent chemist = new ChatCompletionAgent{
    Name = "ChemistryExpert",
    Instructions = "You are an expert in chemistry. You answer questions from a chemistry perspective."
    Kernel = kernel,
};
```



### Set Up the Concurrent Orchestration 设置并发业务流程

The `ConcurrentOrchestration` class allows you to run multiple agents in parallel. You pass the list of agents as members.
`ConcurrentOrchestration` 类允许您并行运行多个代理。您将代理列表作为成员传递。

C#Copy  复制

```csharp
ConcurrentOrchestration orchestration = new (physicist, chemist);
```



### Start the Runtime  启动运行时

A runtime is required to manage the execution of agents. Here, we use `InProcessRuntime` and start it before invoking the orchestration.
需要运行时来管理代理的执行。在这里，我们使用 `InProcessRuntime` 并在调用业务流程之前启动它。

C#Copy  复制

```csharp
InProcessRuntime runtime = new InProcessRuntime();
await runtime.StartAsync();
```



### Invoke the Orchestration  调用业务流程

You can now invoke the orchestration with a specific task. The orchestration will run all agents concurrently on the given task.
现在可以使用特定任务调用业务流程。业务流程将在给定任务上同时运行所有代理。

C#Copy  复制

```csharp
var result = await orchestration.InvokeAsync("What is temperature?", runtime);
```



### Collect Results  收集结果

The results from all agents can be collected asynchronously. Note that the order of results is not guaranteed.
可以异步收集所有代理的结果。请注意，不保证结果的顺序。

C#Copy  复制

```csharp
string[] output = await result.GetValueAsync(TimeSpan.FromSeconds(20));
Console.WriteLine($"# RESULT:\n{string.Join("\n\n", output.Select(text => $"{text}"))}");
```



### Optional: Stop the Runtime 可选：停止运行时

After processing is complete, stop the runtime to clean up resources.
处理完成后，停止运行时以清理资源。

C#Copy  复制

```csharp
await runtime.RunUntilIdleAsync();
```



### Sample Output  示例输出

plaintext  明文Copy  复制

```plaintext
# RESULT:
Temperature is a fundamental physical quantity that measures the average kinetic energy ...

Temperature is a measure of the average kinetic energy of the particles ...
```

 Tip  提示

The full sample code is available [here](https://github.com/microsoft/semantic-kernel/blob/main/dotnet/samples/GettingStartedWithAgents/Orchestration/Step01_Concurrent.cs)
完整的示例代码可在[此处](https://github.com/microsoft/semantic-kernel/blob/main/dotnet/samples/GettingStartedWithAgents/Orchestration/Step01_Concurrent.cs)获得



## Next steps  后续步骤

[  顺序编排](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/sequential)