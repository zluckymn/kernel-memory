# Sequential Orchestration  顺序编排

- 07/22/2025





In sequential orchestration, agents are organized in a pipeline. Each agent processes the task in turn, passing its output to the next agent in the sequence. This is ideal for workflows where each step builds upon the previous one, such as document review, data processing pipelines, or multi-stage reasoning.
在顺序编排中，代理在管道中组织。每个代理依次处理任务，将其输出传递给序列中的下一个代理。这非常适合每个步骤都建立在前一步之上的工作流程，例如文档审查、数据处理管道或多阶段推理。

To learn more about the pattern, such as when to use the pattern or when to avoid the pattern in your workload, see [Sequential orchestration](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/ai-agent-design-patterns#sequential-orchestration).
若要了解有关该模式的详细信息，例如何时使用该模式或何时避免工作负载中的该模式，请参阅顺序[业务流程 ](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/ai-agent-design-patterns#sequential-orchestration)。



## Common Use Cases  常见用例

A document passes through a summarization agent, then a translation agent, and finally a quality assurance agent, each building on the previous output:
文档经过摘要代理，然后是翻译代理，最后是质量保证代理，每个代理都建立在前面的输出之上：

![diagram](https://learn.microsoft.com/en-us/semantic-kernel/media/multi-agent-sequential.png)



## What You'll Learn  您将学到什么

- How to define a sequence of agents, each with a specialized role
  如何定义一系列代理，每个代理都有专门的角色
- How to orchestrate these agents so that each processes the output of the previous one
  如何编排这些代理，以便每个代理都处理前一个代理的输出
- How to observe intermediate outputs and collect the final result
  如何观察中间输出并收集最终结果



### Define Your Agents  定义您的代理

Agents are specialized entities that process tasks in sequence. Here, we define three agents: an analyst, a copywriter, and an editor.
代理是按顺序处理任务的专用实体。在这里，我们定义了三个代理：分析师、文案和编辑。

 Tip  提示

The [`ChatCompletionAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/chat-completion-agent) is used here, but you can use any [agent type](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-architecture#agent-types-in-semantic-kernel).
此处使用 [`ChatCompletionAgent`](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-types/chat-completion-agent)，但您可以使用任何[代理类型 ](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-architecture#agent-types-in-semantic-kernel)。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel;
using Microsoft.SemanticKernel.Agents;
using Microsoft.SemanticKernel.Agents.Orchestration;
using Microsoft.SemanticKernel.Agents.Orchestration.Sequential;
using Microsoft.SemanticKernel.Agents.Runtime.InProcess;

// Create a kernel with an AI service
Kernel kernel = ...;

ChatCompletionAgent analystAgent = new ChatCompletionAgent {
    Name = "Analyst",
    Instructions = "You are a marketing analyst. Given a product description, identify:\n- Key features\n- Target audience\n- Unique selling points",
    Kernel = kernel,
};

ChatCompletionAgent writerAgent = new ChatCompletionAgent {
    Name = "Copywriter",
    Instructions = "You are a marketing copywriter. Given a block of text describing features, audience, and USPs, compose a compelling marketing copy (like a newsletter section) that highlights these points. Output should be short (around 150 words), output just the copy as a single text block.",
    Kernel = kernel,
};

ChatCompletionAgent editorAgent = new ChatCompletionAgent {
    Name = "Editor",
    Instructions = "You are an editor. Given the draft copy, correct grammar, improve clarity, ensure consistent tone, give format and make it polished. Output the final improved copy as a single text block.",
    Kernel = kernel,
};
```



### Optional: Observe Agent Responses 可选：观察代理响应

You can create a callback to capture agent responses as the sequence progresses via the `ResponseCallback` property.
您可以创建回调，以通过 `ResponseCallback` 属性在序列进行时捕获代理响应。

C#Copy  复制

```csharp
ChatHistory history = [];

ValueTask responseCallback(ChatMessageContent response)
{
    history.Add(response);
    return ValueTask.CompletedTask;
}
```



### Set Up the Sequential Orchestration 设置顺序编排

Create a `SequentialOrchestration` object, passing in the agents and the optional response callback.
创建一个 `SequentialOrchestration` 对象，传入代理和可选的响应回调。

C#Copy  复制

```csharp
SequentialOrchestration orchestration = new(analystAgent, writerAgent, editorAgent)
{
    ResponseCallback = responseCallback,
};
```



### Start the Runtime  启动运行时

A runtime is required to manage the execution of agents. Here, we use `InProcessRuntime` and start it before invoking the orchestration.
需要运行时来管理代理的执行。在这里，我们使用 `InProcessRuntime` 并在调用业务流程之前启动它。

C#Copy  复制

```csharp
InProcessRuntime runtime = new InProcessRuntime();
await runtime.StartAsync();
```



### Invoke the Orchestration  调用业务流程

Invoke the orchestration with your initial task (e.g., a product description). The output will flow through each agent in sequence.
使用初始任务（例如，产品描述）调用业务流程。输出将按顺序流经每个代理。

C#Copy  复制

```csharp
var result = await orchestration.InvokeAsync(
    "An eco-friendly stainless steel water bottle that keeps drinks cold for 24 hours",
    runtime);
```



### Collect Results  收集结果

Wait for the orchestration to complete and retrieve the final output.
等待业务流程完成并检索最终输出。

C#Copy  复制

```csharp
string output = await result.GetValueAsync(TimeSpan.FromSeconds(20));
Console.WriteLine($"\n# RESULT: {text}");
Console.WriteLine("\n\nORCHESTRATION HISTORY");
foreach (ChatMessageContent message in history)
{
    this.WriteAgentChatMessage(message);
}
```



### Optional: Stop the Runtime 可选：停止运行时

After processing is complete, stop the runtime to clean up resources.
处理完成后，停止运行时以清理资源。

C#Copy  复制

```csharp
await runtime.RunUntilIdleAsync();
```



### Sample Output  示例输出

plaintext  明文Copy  复制

```plaintext
# RESULT: Introducing our Eco-Friendly Stainless Steel Water Bottles – the perfect companion for those who care about the planet while staying hydrated! Our bottles ...


ORCHESTRATION HISTORY

# Assistant - Analyst: **Key Features:**
- Made from eco-friendly stainless steel
- Insulation technology that maintains cold temperatures for up to 24 hours
- Reusable and sustainable design
- Various sizes and colors available (assumed based on typical offerings)
- Leak-proof cap
- BPA-free ...

# Assistant - copywriter: Introducing our Eco-Friendly Stainless ...

# Assistant - editor: Introducing our Eco-Friendly Stainless Steel Water Bottles – the perfect companion for those who care about the planet while staying hydrated! Our bottles ...
```

 Tip  提示

The full sample code is available [here](https://github.com/microsoft/semantic-kernel/blob/main/dotnet/samples/GettingStartedWithAgents/Orchestration/Step02_Sequential.cs)
完整的示例代码可在[此处](https://github.com/microsoft/semantic-kernel/blob/main/dotnet/samples/GettingStartedWithAgents/Orchestration/Step02_Sequential.cs)获得



## Next steps  后续步骤

[  群聊编排](https://learn.microsoft.com/en-us/semantic-kernel/frameworks/agent/agent-orchestration/group-chat)