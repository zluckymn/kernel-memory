# Text Embedding generation in Semantic Kernel Semantic Kernel中的文本嵌入生成

- 11/14/2024

With text embedding generation, you can use an AI model to generate vectors (aka embeddings). These vectors encode the semantic meaning of the text in such a way that mathematical equations can be used on two vectors to compare the similarity of the original text. This is useful for scenarios such as Retrieval Augmented Generation (RAG), where we want to search a database of information for text related to a user query. Any matching information can then be provided as input to Chat Completion, so that the AI Model has more context when answering the user query.
通过文本嵌入生成，您可以使用 AI 模型生成向量（又称嵌入）。这些向量以这样一种方式编码文本的语义含义，以便可以在两个向量上使用数学方程来比较原始文本的相似性。这对于检索增强生成 （RAG） 等方案非常有用，在这些场景中，我们想要在信息数据库中搜索与用户查询相关的文本。然后，任何匹配的信息都可以作为聊天完成的输入提供，以便 AI 模型在回答用户查询时拥有更多上下文。

When choosing an embedding model, you will need to consider the following:
选择嵌入模型时，您需要考虑以下因素：

- What is the size of the vectors generated by the model, and is it configurable, as this will affect your vector storage cost.
  模型生成的向量的大小是多少，是否可配置，因为这会影响您的向量存储成本。
- What type of elements does the generated vectors contain, e.g. float32, float16, etc, as this will affect your vector storage cost.
  生成的向量包含什么类型的元素，例如 float32、float16 等，因为这会影响您的向量存储成本。
- How fast does it generate vectors?
  它生成载体的速度有多快？
- How much does generation cost?
  发电费用是多少？

 Tip  提示

For more information about storing and searching vectors see [What are Semantic Kernel Vector Store connectors?](https://learn.microsoft.com/en-us/semantic-kernel/concepts/vector-store-connectors/)
有关存储和搜索向量的详细信息，请参阅[什么是Semantic Kernel向量存储连接器？](https://learn.microsoft.com/en-us/semantic-kernel/concepts/vector-store-connectors/)

 Tip  提示

For more information about using RAG with vector stores in Semantic Kernel, see [How to use Vector Stores with Semantic Kernel Text Search](https://learn.microsoft.com/en-us/semantic-kernel/concepts/text-search/text-search-vector-stores) and [What are Semantic Kernel Text Search plugins?](https://learn.microsoft.com/en-us/semantic-kernel/concepts/text-search/text-search-plugins)
有关在Semantic Kernel中将 RAG 与向量存储一起使用的更多信息，请参阅如何[将向量存储与Semantic Kernel文本搜索一起使用](https://learn.microsoft.com/en-us/semantic-kernel/concepts/text-search/text-search-vector-stores)和[什么是Semantic Kernel文本搜索插件？](https://learn.microsoft.com/en-us/semantic-kernel/concepts/text-search/text-search-plugins)



## Setting up your local environment 设置本地环境

Some of the AI Services can be hosted locally and may require some setup. Below are instructions for those that support this.
某些 AI 服务可以托管在本地，可能需要一些设置。以下是支持此功能的说明。

- [Azure OpenAI](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-AzureOpenAI)
- [OpenAI  开放人工智能](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-OpenAI)
- [Mistral  米斯特拉尔](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-Mistral)
- [Google  谷歌](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-Google)
- [Hugging Face  拥抱脸](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-HuggingFace)
- [Ollama  奥拉玛](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-Ollama)
- [ONNX](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_1_csharp-ONNX)

No local setup.  没有本地设置。



## Installing the necessary packages 安装必要的软件包

Before adding embedding generation to your kernel, you will need to install the necessary packages. Below are the packages you will need to install for each AI service provider.
在将嵌入生成添加到内核之前，您需要安装必要的软件包。以下是您需要为每个 AI 服务提供商安装的软件包。

- [Azure OpenAI](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-AzureOpenAI)
- [OpenAI  开放人工智能](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-OpenAI)
- [Mistral  米斯特拉尔](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-Mistral)
- [Google  谷歌](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-Google)
- [Hugging Face  拥抱脸](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-HuggingFace)
- [Ollama  奥拉玛](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-Ollama)
- [ONNX](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_2_csharp-ONNX)

Bash  猛击Copy  复制

```bash
dotnet add package Microsoft.SemanticKernel.Connectors.AzureOpenAI
```



## Creating text embedding generation services 创建文本嵌入生成服务

Now that you've installed the necessary packages, you can create a text embedding generation service. Below are the several ways you can text create embedding generation services using Semantic Kernel.
现在您已经安装了必要的包，您可以创建文本嵌入生成服务。以下是使用Semantic Kernel创建文本嵌入生成服务的几种方法。



### Adding directly to the kernel 直接添加到内核

To add a text embedding generation service, you can use the following code to add it to the kernel's inner service provider.
要添加文本嵌入生成服务，您可以使用以下代码将其添加到内核的内部服务提供程序中。

- [Azure OpenAI](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-AzureOpenAI)
- [OpenAI  开放人工智能](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-OpenAI)
- [Mistral  米斯特拉尔](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-Mistral)
- [Google  谷歌](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-Google)
- [Hugging Face  拥抱脸](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-HuggingFace)
- [Ollama  奥拉玛](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-Ollama)
- [ONNX](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_3_csharp-ONNX)

 Important  重要

The Azure OpenAI embedding generation connector is currently experimental. To use it, you will need to add `#pragma warning disable SKEXP0010`.
Azure OpenAI 嵌入生成连接器目前处于实验阶段。要使用它，您需要添加 `#pragma warning disable SKEXP0010` .

C#Copy  复制

```csharp
using Microsoft.SemanticKernel;

#pragma warning disable SKEXP0010
IKernelBuilder kernelBuilder = Kernel.CreateBuilder();
kernelBuilder.AddAzureOpenAITextEmbeddingGeneration(
    deploymentName: "NAME_OF_YOUR_DEPLOYMENT", // Name of deployment, e.g. "text-embedding-ada-002".
    endpoint: "YOUR_AZURE_ENDPOINT",           // Name of Azure OpenAI service endpoint, e.g. https://myaiservice.openai.azure.com.
    apiKey: "YOUR_API_KEY",
    modelId: "MODEL_ID",          // Optional name of the underlying model if the deployment name doesn't match the model name, e.g. text-embedding-ada-002.
    serviceId: "YOUR_SERVICE_ID", // Optional; for targeting specific services within Semantic Kernel.
    httpClient: new HttpClient(), // Optional; if not provided, the HttpClient from the kernel will be used.
    dimensions: 1536              // Optional number of dimensions to generate embeddings with.
);
Kernel kernel = kernelBuilder.Build();
```



### Using dependency injection 使用依赖注入

If you're using dependency injection, you'll likely want to add your text embedding generation services directly to the service provider. This is helpful if you want to create singletons of your embedding generation services and reuse them in transient kernels.
如果您使用的是依赖项注入，您可能希望将文本嵌入生成服务直接添加到服务提供商。如果您想创建嵌入生成服务的单例并在瞬态内核中重用它们，这将很有用。

- [Azure OpenAI](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-AzureOpenAI)
- [OpenAI  开放人工智能](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-OpenAI)
- [Mistral  米斯特拉尔](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-Mistral)
- [Google  谷歌](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-Google)
- [Hugging Face  拥抱脸](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-HuggingFace)
- [Ollama  奥拉玛](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-Ollama)
- [ONNX](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_4_csharp-ONNX)

 Important  重要

The Azure OpenAI embedding generation connector is currently experimental. To use it, you will need to add `#pragma warning disable SKEXP0010`.
Azure OpenAI 嵌入生成连接器目前处于实验阶段。要使用它，您需要添加 `#pragma warning disable SKEXP0010` .

C#Copy  复制

```csharp
using Microsoft.SemanticKernel;

var builder = Host.CreateApplicationBuilder(args);

#pragma warning disable SKEXP0010
builder.Services.AddAzureOpenAITextEmbeddingGeneration(
    deploymentName: "NAME_OF_YOUR_DEPLOYMENT", // Name of deployment, e.g. "text-embedding-ada-002".
    endpoint: "YOUR_AZURE_ENDPOINT",           // Name of Azure OpenAI service endpoint, e.g. https://myaiservice.openai.azure.com.
    apiKey: "YOUR_API_KEY",
    modelId: "MODEL_ID",          // Optional name of the underlying model if the deployment name doesn't match the model name, e.g. text-embedding-ada-002.
    serviceId: "YOUR_SERVICE_ID", // Optional; for targeting specific services within Semantic Kernel.
    dimensions: 1536              // Optional number of dimensions to generate embeddings with.
);

builder.Services.AddTransient((serviceProvider)=> {
    return new Kernel(serviceProvider);
});
```



### Creating standalone instances 创建独立实例

Lastly, you can create instances of the service directly so that you can either add them to a kernel later or use them directly in your code without ever injecting them into the kernel or in a service provider.
最后，您可以直接创建服务的实例，以便稍后可以将它们添加到内核中，也可以直接在代码中使用它们，而无需将它们注入内核或服务提供商中。

- [Azure OpenAI](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-AzureOpenAI)
- [OpenAI  开放人工智能](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-OpenAI)
- [Mistral  米斯特拉尔](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-Mistral)
- [Google  谷歌](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-Google)
- [Hugging Face  拥抱脸](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-HuggingFace)
- [Ollama  奥拉玛](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-Ollama)
- [ONNX](https://learn.microsoft.com/en-us/semantic-kernel/concepts/ai-services/embedding-generation/?tabs=csharp-AzureOpenAI&pivots=programming-language-csharp#tabpanel_5_csharp-ONNX)

 Important  重要

The Azure OpenAI embedding generation connector is currently experimental. To use it, you will need to add `#pragma warning disable SKEXP0010`.
Azure OpenAI 嵌入生成连接器目前处于实验阶段。要使用它，您需要添加 `#pragma warning disable SKEXP0010` .

C#Copy  复制

```csharp
using Microsoft.SemanticKernel.Connectors.AzureOpenAI;

#pragma warning disable SKEXP0010
AzureOpenAITextEmbeddingGenerationService textEmbeddingGenerationService = new (
    deploymentName: "NAME_OF_YOUR_DEPLOYMENT", // Name of deployment, e.g. "text-embedding-ada-002".
    endpoint: "YOUR_AZURE_ENDPOINT",           // Name of Azure OpenAI service endpoint, e.g. https://myaiservice.openai.azure.com.
    apiKey: "YOUR_API_KEY",
    modelId: "MODEL_ID",          // Optional name of the underlying model if the deployment name doesn't match the model name, e.g. text-embedding-ada-002.
    httpClient: new HttpClient(), // Optional; if not provided, the HttpClient from the kernel will be used.
    dimensions: 1536              // Optional number of dimensions to generate embeddings with.
);
```



## Using text embedding generation services 使用文本嵌入生成服务

All text embedding generation services implement the `ITextEmbeddingGenerationService` which has a single method `GenerateEmbeddingsAsync` that can generate `ReadOnlyMemory<float>` vectors from provided `string` values. An extension method `GenerateEmbeddingAsync` is also available for single value versions of the same action.
所有文本嵌入生成服务都实现具有 `ITextEmbeddingGenerationService` 单个方法 `GenerateEmbeddingsAsync` 可以从提供的`字符串`值生成 `ReadOnlyMemory<float>` 向量。扩展方法 `GenerateEmbeddingAsync` 也可用于同一作的单值版本。

Here is an example of how to invoke the service with multiple values.
下面是如何使用多个值调用服务的示例。

C#Copy  复制

```csharp
IList<ReadOnlyMemory<float>> embeddings =
    await textEmbeddingGenerationService.GenerateEmbeddingsAsync(
    [
        "sample text 1",
        "sample text 2"
    ]);
```

Here is an example of how to invoke the service with a single value.
下面是如何使用单个值调用服务的示例。

C#Copy  复制

```csharp
using Microsoft.SemanticKernel.Embeddings;

ReadOnlyMemory<float> embedding =
    await textEmbeddingGenerationService.GenerateEmbeddingAsync("sample text");
```